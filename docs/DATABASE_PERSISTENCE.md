# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Docker

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã, –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Docker Volumes
```yaml
# docker-compose.yml
services:
  postgres:
    volumes:
      - postgres_data:/var/lib/postgresql/data  # –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
      - ./backend/init.sql:/docker-entrypoint-initdb.d/init.sql
      - ./backups:/backups  # –ü–∞–ø–∫–∞ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
    restart: unless-stopped  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

volumes:
  postgres_data:  # –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  pgadmin_data:   # –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π volume –¥–ª—è pgAdmin
```

### 2. –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±—ç–∫–∞–ø–∞

#### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
- **`backup_db.sh`** - —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã
- **`restore_db.sh`** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

#### –î–ª—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
- **`backup_db_docker.sh`** - —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **`restore_db_docker.sh`** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
online_library/
‚îú‚îÄ‚îÄ docker-compose.yml          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å volumes
‚îú‚îÄ‚îÄ backup_db.sh               # –ë—ç–∫–∞–ø –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
‚îú‚îÄ‚îÄ restore_db.sh              # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
‚îú‚îÄ‚îÄ backup_db_docker.sh        # –ë—ç–∫–∞–ø Docker –ë–î
‚îú‚îÄ‚îÄ restore_db_docker.sh       # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Docker –ë–î
‚îî‚îÄ‚îÄ backups/                   # –ü–∞–ø–∫–∞ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
    ‚îî‚îÄ‚îÄ online_library_*.sql   # –§–∞–π–ª—ã –±—ç–∫–∞–ø–æ–≤
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
```bash
# –î–ª—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./backup_db_docker.sh

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
./backup_db_docker.sh my_backup.sql

# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
./backup_db.sh
```

### üì• –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
```bash
# –î–ª—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
./restore_db_docker.sh backups/online_library_20241021_210300.sql

# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
./restore_db.sh backups/online_library_20241021_210300.sql
```

### üê≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä volumes
docker volume ls

# –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –≤ volume
docker volume inspect online_library_postgres_data
```

## –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ **Volumes –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:**
- **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### üìã **–°—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏:**
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
2. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
3. **–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
4. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ

### ‚ö†Ô∏è **–ß—Ç–æ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
- –£–¥–∞–ª–µ–Ω–∏–µ volume: `docker volume rm online_library_postgres_data`
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üîÑ **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã:**
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø (–¥–æ–±–∞–≤–∏—Ç—å –≤ cron)
0 2 * * * /path/to/backup_db_docker.sh daily_$(date +\%Y\%m\%d).sql

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±—ç–∫–∞–ø
0 3 * * 0 /path/to/backup_db_docker.sh weekly_$(date +\%Y\%m\%d).sql
```

### üìÅ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –±—ç–∫–∞–ø–æ–≤
ls -la backups/

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find backups/ -name "*.sql" -mtime +30 -delete
```

### üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker-compose up -d`
2. –î–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É
3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker-compose down`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: `docker-compose up -d`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- ‚úÖ –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Volumes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
